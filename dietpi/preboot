#!/bin/bash
{
	#////////////////////////////////////
	# DietPi PreBoot Script
	#
	#////////////////////////////////////
	# Created by Daniel Knight / daniel.knight@dietpi.com / dietpi.com
	#
	#////////////////////////////////////
	#
	# Info:
	# - Location: /boot/dietpi/preboot
	# - Activates on boot from dietpi-preboot.service, runs before dietpi-boot.service and networking
	#////////////////////////////////////

	#/////////////////////////////////////////////////////////////////////////////////////
	# Main Loop
	#/////////////////////////////////////////////////////////////////////////////////////
	#-----------------------------------------------------------------------------------
	# RPi
	if [[ ! -f '/etc/.dietpi_hw_model_identifier' ]]; then

		# Disable video output on RPi when headless mode has been chosen
		grep -q '^[[:blank:]]*AUTO_SETUP_HEADLESS=1' /boot/dietpi.txt && tvservice -o

		# Force hardware info reload to allow SDcard swapping
		/boot/dietpi/func/dietpi-obtain_hw_model

	fi

	# Obtain hardware info if missing
	[[ -f '/boot/dietpi/.hw_model' ]] || /boot/dietpi/func/dietpi-obtain_hw_model

	# Apply CPU governor and settings
	/boot/dietpi/func/dietpi-set_cpu
	#-----------------------------------------------------------------------------------
	exit
	#-----------------------------------------------------------------------------------
}
